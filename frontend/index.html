<!doctype html>
<html lang="en">

<head>
    <title>Plasma Prime</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css"
          href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- Material Kit CSS -->
    <link href="assets/css/material-kit.min.css" rel="stylesheet"/>
    <link href="assets/css/custom.css" rel="stylesheet"/>
</head>
<body>
<div class="page-header header-filter" style="height: 150px !important; background-color: green !important;">
    <div class="container">
        <div class="row">
        </div>
    </div>
</div>
<div class="main main-raised">
    <div class="container">
        <div class="section section-text">
            <div class="row">
                <div class="col-md-6 col-lg-4">
                    <div class="rotating-card-container manual-flip" style="margin-bottom: 30px;">
                        <div class="card card-rotate">
                            <div class="front front-background"
                                 style="background-image: url(./assets/img/deposit.png); width: 350px;">
                                <div class="card-body">

                                    <a href="#pablo">
                                        <h3 class="card-title">Make a deposit</h3>
                                    </a>
                                    <p class="card-description">

                                    </p>
                                    <div class="stats text-center">
                                        <button type="button" name="button"
                                                class="btn btn-success btn-fill btn-round btn-rotate">
                                            <i class="material-icons">eject</i> Deposit
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="back"
                                 style="background-color: #FFFFFF !important; width: 350px;">
                                <div class="card-body">
                                    <h3 class="card-title">
                                        Enter ETH amount in wei
                                    </h3>
                                    <div class="form-group has-default bmd-form-group">
                                        <input type="text" id="deposit_amount" class="form-control"
                                               placeholder="Example: 19999999">
                                    </div>
                                    <button type="button" name="button"
                                            class="btn btn-success btn-fill btn-round" onclick="deposit()">
                                        <i class="material-icons">eject</i> Deposit
                                    </button>
                                    <button type="button" name="button"
                                            class="btn btn-secondary btn-fill btn-round btn-rotate">
                                        <i class="material-icons">refresh</i> Back
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="rotating-card-container manual-flip" style="margin-bottom: 30px;">
                        <div class="card card-rotate">
                            <div class="front front-background"
                                 style="background-image: url(./assets/img/transaction.png); width: 350px;">
                                <div class="card-body">
                                    <a href="#pablo">
                                        <h3 class="card-title">Send money in plasma</h3>
                                    </a>
                                    <p class="card-description">
                                    </p>
                                    <div class="stats text-center">
                                        <button type="button" name="button"
                                                class="btn btn-success btn-fill btn-round btn-rotate">
                                            <i class="material-icons">eject</i> Send
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="back"
                                 style="background-color: #FFFFFF !important; width: 350px; min-height: 400px">
                                <div class="card-body">
                                    <h3 class="card-title">
                                        Enter ETH and address
                                    </h3>
                                    <div class="form-group has-default bmd-form-group">
                                        <input type="text" class="form-control" placeholder="ETH amount: 19999999"
                                               id="transfer_amount">
                                    </div>
                                    <div class="form-group has-default bmd-form-group">
                                        <input type="text" class="form-control"
                                               placeholder="Address: 0x000000000000000000" id="transfer_address">
                                    </div>
                                    <button type="button" name="button"
                                            class="btn btn-success btn-fill btn-round" onclick="transfer()">
                                        <i class="material-icons">eject</i> Send
                                    </button>
                                    <button type="button" name="button"
                                            class="btn btn-secondary btn-fill btn-round btn-rotate">
                                        <i class="material-icons">refresh</i> Back
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4 last-card">
                    <div class="rotating-card-container manual-flip" style="margin-bottom: 30px;">
                        <div class="card card-rotate">
                            <div class="front front-background"
                                 style="background-image: url(./assets/img/exit.png); width: 350px;">
                                <div class="card-body">
                                    <a href="#pablo">
                                        <h3 class="card-title">Get money from plasma</h3>
                                    </a>
                                    <p class="card-description">
                                    </p>
                                    <div class="stats text-center">
                                        <button type="button" name="button"
                                                class="btn btn-success btn-fill btn-round btn-rotate">
                                            <i class="material-icons">home</i> Exit
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="back"
                                 style="background-color: #FFFFFF !important; width: 350px;">
                                <div class="card-body">
                                    <h3 class="card-title">
                                        Get all money back
                                    </h3>
                                    <button type="button" name="button"
                                            class="btn btn-success btn-fill btn-round" onclick="exit()">
                                        <i class="material-icons">eject</i> Exit
                                    </button>
                                    <button type="button" name="button"
                                            class="btn btn-secondary btn-fill btn-round btn-rotate">
                                        <i class="material-icons">refresh</i> Back
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row section">
            <div class=" col-sm-4">
                <div class="card card-contact card-raised">
                    <div class="card-header card-header-success text-center">
                        <h4 class="card-title">Current status</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-12 text-center">
                                <div class="info">
                                    <div class="icon icon-success">
                                        <i class="material-icons">check</i>

                                    </div>
                                    <h3 class="info-title">Plasma works fine</h3>
                                    <h4>Contract address: <span id="contract_address"></span></h4>
                                </div>

                            </div>
                            <div class="col-md-6 text-center">
                                <div class="info">
                                    <div class="icon icon-success">
                                        <i class="material-icons">desktop_windows</i>
                                        <i class="material-icons">desktop_windows</i>
                                    </div>
                                    <h3 class="info-title">Amount of verifiers</h3>
                                    <h3><span id="verifiers_amount"></span></h3>
                                </div>
                            </div>
                            <div class="col-md-6 text-center">
                                <div class="info">
                                    <div class="icon icon-success">
                                        <i class="material-icons">block</i>
                                    </div>
                                    <h3 class="info-title">Latest block</h3>
                                    <h3> <span id="latest_block"></span></h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class=" col-sm-8">
                <div class="card card-contact card-raised">
                    <div class="card-header card-header-success text-center">
                        <h4 class="card-title">Additional information</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-sm-12 text-center">
                                <div class="info">
                                    <img style="max-width: 200px"
                                         src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/ed/Hilbert_curve_2.svg/512px-Hilbert_curve_2.svg.png"
                                         alt=""/>
                                    <br>
                                    <h3>Total balance: <span id="balance"></span> WEI</h3>
                                    <h3>My balance: <span id="my_balance"></span> WEI</h3>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <h2 align="center">My operations history</h2>
                                <div class="table-responsive">
                                    <table id="history_table" class="table">
                                        <thead>
                                        <tr>
                                            <th class="text-center">Date</th>
                                            <th class="text-center">Type</th>
                                            <th class="text-center">Sum</th>
                                        </tr>
                                        </thead>
                                        <tbody id="history">

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
<footer class="footer footer-default">
    <div class="container">
        <nav class="float-left">
            <ul>
                <li>
                    <a href="https://bankex.com">
                        Bankex Foundation Team, Specially for Ethereum Singapore hackathon
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</footer>
<script src="assets/js/core/jquery.min.js" type="text/javascript"></script>
<script src="assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="assets/js/core/bootstrap-material-design.min.js" type="text/javascript"></script>
<script src="assets/js/plugins/moment.min.js"></script>
<!--	Plugin for the Datepicker, full documentation here: https://github.com/Eonasdan/bootstrap-datetimepicker -->
<script src="assets/js/plugins/bootstrap-datetimepicker.js" type="text/javascript"></script>
<!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
<script src="assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
<!--	Plugin for Tags, full documentation here: https://github.com/bootstrap-tagsinput/bootstrap-tagsinputs  -->
<script src="assets/js/plugins/bootstrap-tagsinput.js"></script>
<!--	Plugin for Select, full documentation here: http://silviomoreto.github.io/bootstrap-select -->
<script src="assets/js/plugins/bootstrap-selectpicker.js" type="text/javascript"></script>
<!--	Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
<script src="assets/js/plugins/jasny-bootstrap.min.js" type="text/javascript"></script>
<!-- Place this tag in your head or just before your close body tag. -->
<script async defer src="https://buttons.github.io/buttons.js"></script>
<!-- Control Center for Material Kit: parallax effects, scripts for the example pages etc -->
<script src="assets/js/material-kit.min.js" type="text/javascript"></script>

<script>
    const endpoint_url = 'http://localhost:8080';

    async function deposit() {
        value = getInputData("deposit_amount");
        const result = await getRequest(value, "", "deposit");
        let i = localStorage.getItem("itemsLength");
        if (i == undefined) {
            i = 0;
        }
        let data = JSON.stringify({date: new Date(), val: value, event_type: "Deposit", txHash: result.txHash});
        localStorage.setItem(i, data);
        i++;
        localStorage.setItem("itemsLength", i);
        console.log(result)
    }

    async function transfer() {
        value = getInputData("transfer_amount");
        address = getInputData("transfer_address");
        const result = await getRequest(value, address, "transfer");
        console.log(result)
    }

    async function exit() {
        const result = await getRequest("", "", "exit");
        console.log(result)
    }

    function getInputData(id) {
        return document.getElementById(id).value;
    }

    async function getRequest(sum, address, api_method) {
        if (sum != "" && address != "") {
            const response = await fetch(endpoint_url + '/' + api_method + '/' + address + "/" + sum);
            if (response.ok === false)
                return new Error("Error");
            else
                return (response.json());

        } else if (address == "" && sum != "") {
            const response = await fetch(endpoint_url + '/' + api_method + '/' + sum);
            if (response.ok === false)
                return new Error("Error");
            else
                return (response.json());
        } else {
            const response = await fetch(endpoint_url + '/' + api_method);
            if (response.ok === false)
                return new Error("Error");
            else
                return (response.json());
        }
    }

    var data = [];
    var event_type = [];
    var amount = [];

    function update() {
        for (let i = 0; i < localStorage.getItem("itemsLength"); i++) {
            data.push(JSON.parse(localStorage.getItem(i)).date);
            event_type.push(JSON.parse(localStorage.getItem(i)).event_type);
            amount.push(JSON.parse(localStorage.getItem(i)).val);
        }
    }

    function make_table() {
        for (let j = 0; j < localStorage.getItem("itemsLength"); j++) {
            document.getElementById("history").innerHTML += "<tbody>\n" +
                "                                        <tr>\n" +
                "                                            <td class=\"text-center\">" + data[j] + "</td>\n" +
                "                                            <td class=\"text-center\">" + event_type[j] + "</td>\n" +
                "                                            <td class=\"text-center\">" + amount[j] + "</td>\n" +
                "                                        </tr>\n" +
                "                                        </tbody>"
        }
    }

    function clear() {
        document.getElementById("history_table").innerHTML =
            "                                        <thead>\n" +
            "                                        <tr>\n" +
            "                                            <th class=\"text-center\">Date</th>\n" +
            "                                            <th class=\"text-center\">Type</th>\n" +
            "                                            <th class=\"text-center\">Sum</th>\n" +
            "                                        </tr>\n" +
            "                                        </thead>\n" +
            "                                        <tbody id=\"history\">\n" +
            "                                        </tbody>"
    }

    window.setInterval(async function () {
        let block_number = await block_number_get();
        let verifiers_amount = await verifiers_amount_get();
        let balance = await balance_get();
        let my_balance = await my_balance_get();
        let contract_address = await contract_address_get();

        document.getElementById("latest_block").innerText = block_number;
        document.getElementById("verifiers_amount").innerText = verifiers_amount;
        document.getElementById("balance").innerText = balance;
        document.getElementById("my_balance").innerText = my_balance;
        document.getElementById("contract_address").innerText = contract_address;

        clear();
        update();
        make_table();

    }, 500);


    async function contract_address_get() {
        const result = await getRequest("", "", "contractAddress");
        return (result.address);
    }
    async function my_balance_get() {
        const result = await getRequest("", "", "etherBalance");
        return (result.balance);
    }
    async function block_number_get() {
        const result = await getRequest("", "", "latestBlock");
        // console.log(result.latest_block_number);
        return (result.latest_block_number);
    }

    async function verifiers_amount_get() {
        const result = await getRequest("", "", "verifiersAmount");
        // console.log(result.verifiers_amount);
        return (result.verifiers_amount);
    }

    async function balance_get() {
        const result = await getRequest("", "", "totalBalance");
        // console.log(result.balance);
        return (result.balance);
    }


</script>
</body>

</html>