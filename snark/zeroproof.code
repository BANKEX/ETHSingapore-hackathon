//template for algebraic hash
// plasma is 32bit. so, all magnitudes limeted by 2^32-1
// NOT IMPLEMENTED: safe algebraic hash. Overflows are safe due summerkletree architecture in plasma.

// use custom Zokrates from https://github.com/snjax/ZoKrates
import "PACKING/unpack254"

def truncate(field x, field y) -> (field):
  x253, x252, x251, x250, x249, x248, x247, x246, x245, x244, x243, x242, x241, x240, x239, x238, x237, x236, x235, x234, x233, x232, x231, x230, x229, x228, x227, x226, x225, x224, x223, x222, x221, x220, x219, x218, x217, x216, x215, x214, x213, x212, x211, x210, x209, x208, x207, x206, x205, x204, x203, x202, x201, x200, x199, x198, x197, x196, x195, x194, x193, x192, x191, x190, x189, x188, x187, x186, x185, x184, x183, x182, x181, x180, x179, x178, x177, x176, x175, x174, x173, x172, x171, x170, x169, x168, x167, x166, x165, x164, x163, x162, x161, x160, x159, x158, x157, x156, x155, x154, x153, x152, x151, x150, x149, x148, x147, x146, x145, x144, x143, x142, x141, x140, x139, x138, x137, x136, x135, x134, x133, x132, x131, x130, x129, x128, x127, x126, x125, x124, x123, x122, x121, x120, x119, x118, x117, x116, x115, x114, x113, x112, x111, x110, x109, x108, x107, x106, x105, x104, x103, x102, x101, x100, x99, x98, x97, x96, x95, x94, x93, x92, x91, x90, x89, x88, x87, x86, x85, x84, x83, x82, x81, x80, x79, x78, x77, x76, x75, x74, x73, x72, x71, x70, x69, x68, x67, x66, x65, x64, x63, x62, x61, x60, x59, x58, x57, x56, x55, x54, x53, x52, x51, x50, x49, x48, x47, x46, x45, x44, x43, x42, x41, x40, x39, x38, x37, x36, x35, x34, x33, x32, x31, x30, x29, x28, x27, x26, x25, x24, x23, x22, x21, x20, x19, x18, x17, x16, x15, x14, x13, x12, x11, x10, x9, x8, x7, x6, x5, x4, x3, x2, x1, x0 = unpack254(x)
  y253, y252, y251, y250, y249, y248, y247, y246, y245, y244, y243, y242, y241, y240, y239, y238, y237, y236, y235, y234, y233, y232, y231, y230, y229, y228, y227, y226, y225, y224, y223, y222, y221, y220, y219, y218, y217, y216, y215, y214, y213, y212, y211, y210, y209, y208, y207, y206, y205, y204, y203, y202, y201, y200, y199, y198, y197, y196, y195, y194, y193, y192, y191, y190, y189, y188, y187, y186, y185, y184, y183, y182, y181, y180, y179, y178, y177, y176, y175, y174, y173, y172, y171, y170, y169, y168, y167, y166, y165, y164, y163, y162, y161, y160, y159, y158, y157, y156, y155, y154, y153, y152, y151, y150, y149, y148, y147, y146, y145, y144, y143, y142, y141, y140, y139, y138, y137, y136, y135, y134, y133, y132, y131, y130, y129, y128, y127, y126, y125, y124, y123, y122, y121, y120, y119, y118, y117, y116, y115, y114, y113, y112, y111, y110, y109, y108, y107, y106, y105, y104, y103, y102, y101, y100, y99, y98, y97, y96, y95, y94, y93, y92, y91, y90, y89, y88, y87, y86, y85, y84, y83, y82, y81, y80, y79, y78, y77, y76, y75, y74, y73, y72, y71, y70, y69, y68, y67, y66, y65, y64, y63, y62, y61, y60, y59, y58, y57, y56, y55, y54, y53, y52, y51, y50, y49, y48, y47, y46, y45, y44, y43, y42, y41, y40, y39, y38, y37, y36, y35, y34, y33, y32, y31, y30, y29, y28, y27, y26, y25, y24, y23, y22, y21, y20, y19, y18, y17, y16, y15, y14, y13, y12, y11, y10, y9, y8, y7, y6, y5, y4, y3, y2, y1, y0 = unpack254(y)
  field res = 0
  res = res + y127*170141183460469231731687303715884105728
  res = res + y126*85070591730234615865843651857942052864
  res = res + y125*42535295865117307932921825928971026432
  res = res + y124*21267647932558653966460912964485513216
  res = res + y123*10633823966279326983230456482242756608
  res = res + y122*5316911983139663491615228241121378304
  res = res + y121*2658455991569831745807614120560689152
  res = res + y120*1329227995784915872903807060280344576
  res = res + y119*664613997892457936451903530140172288
  res = res + y118*332306998946228968225951765070086144
  res = res + y117*166153499473114484112975882535043072
  res = res + y116*83076749736557242056487941267521536
  res = res + y115*41538374868278621028243970633760768
  res = res + y114*20769187434139310514121985316880384
  res = res + y113*10384593717069655257060992658440192
  res = res + y112*5192296858534827628530496329220096
  res = res + y111*2596148429267413814265248164610048
  res = res + y110*1298074214633706907132624082305024
  res = res + y109*649037107316853453566312041152512
  res = res + y108*324518553658426726783156020576256
  res = res + y107*162259276829213363391578010288128
  res = res + y106*81129638414606681695789005144064
  res = res + y105*40564819207303340847894502572032
  res = res + y104*20282409603651670423947251286016
  res = res + y103*10141204801825835211973625643008
  res = res + y102*5070602400912917605986812821504
  res = res + y101*2535301200456458802993406410752
  res = res + y100*1267650600228229401496703205376
  res = res + y99*633825300114114700748351602688
  res = res + y98*316912650057057350374175801344
  res = res + y97*158456325028528675187087900672
  res = res + y96*79228162514264337593543950336
  res = res + y95*39614081257132168796771975168
  res = res + y94*19807040628566084398385987584
  res = res + y93*9903520314283042199192993792
  res = res + y92*4951760157141521099596496896
  res = res + y91*2475880078570760549798248448
  res = res + y90*1237940039285380274899124224
  res = res + y89*618970019642690137449562112
  res = res + y88*309485009821345068724781056
  res = res + y87*154742504910672534362390528
  res = res + y86*77371252455336267181195264
  res = res + y85*38685626227668133590597632
  res = res + y84*19342813113834066795298816
  res = res + y83*9671406556917033397649408
  res = res + y82*4835703278458516698824704
  res = res + y81*2417851639229258349412352
  res = res + y80*1208925819614629174706176
  res = res + y79*604462909807314587353088
  res = res + y78*302231454903657293676544
  res = res + y77*151115727451828646838272
  res = res + y76*75557863725914323419136
  res = res + y75*37778931862957161709568
  res = res + y74*18889465931478580854784
  res = res + y73*9444732965739290427392
  res = res + y72*4722366482869645213696
  res = res + y71*2361183241434822606848
  res = res + y70*1180591620717411303424
  res = res + y69*590295810358705651712
  res = res + y68*295147905179352825856
  res = res + y67*147573952589676412928
  res = res + y66*73786976294838206464
  res = res + y65*36893488147419103232
  res = res + y64*18446744073709551616
  res = res + y63*9223372036854775808
  res = res + y62*4611686018427387904
  res = res + y61*2305843009213693952
  res = res + y60*1152921504606846976
  res = res + y59*576460752303423488
  res = res + y58*288230376151711744
  res = res + y57*144115188075855872
  res = res + y56*72057594037927936
  res = res + y55*36028797018963968
  res = res + y54*18014398509481984
  res = res + y53*9007199254740992
  res = res + y52*4503599627370496
  res = res + y51*2251799813685248
  res = res + y50*1125899906842624
  res = res + y49*562949953421312
  res = res + y48*281474976710656
  res = res + y47*140737488355328
  res = res + y46*70368744177664
  res = res + y45*35184372088832
  res = res + y44*17592186044416
  res = res + y43*8796093022208
  res = res + y42*4398046511104
  res = res + y41*2199023255552
  res = res + y40*1099511627776
  res = res + y39*549755813888
  res = res + y38*274877906944
  res = res + y37*137438953472
  res = res + y36*68719476736
  res = res + y35*34359738368
  res = res + y34*17179869184
  res = res + y33*8589934592
  res = res + y32*4294967296
  res = res + y31*2147483648
  res = res + y30*1073741824
  res = res + y29*536870912
  res = res + y28*268435456
  res = res + y27*134217728
  res = res + y26*67108864
  res = res + y25*33554432
  res = res + y24*16777216
  res = res + y23*8388608
  res = res + y22*4194304
  res = res + y21*2097152
  res = res + y20*1048576
  res = res + y19*524288
  res = res + y18*262144
  res = res + y17*131072
  res = res + y16*65536
  res = res + y15*32768
  res = res + y14*16384
  res = res + y13*8192
  res = res + y12*4096
  res = res + y11*2048
  res = res + y10*1024
  res = res + y9*512
  res = res + y8*256
  res = res + y7*128
  res = res + y6*64
  res = res + y5*32
  res = res + y4*16
  res = res + y3*8
  res = res + y2*4
  res = res + y1*2
  res = res + y0
  res = res + x127*57896044618658097711785492504343953926634992332820282019728792003956564819968
  res = res + x126*28948022309329048855892746252171976963317496166410141009864396001978282409984
  res = res + x125*14474011154664524427946373126085988481658748083205070504932198000989141204992
  res = res + x124*7237005577332262213973186563042994240829374041602535252466099000494570602496
  res = res + x123*3618502788666131106986593281521497120414687020801267626233049500247285301248
  res = res + x122*1809251394333065553493296640760748560207343510400633813116524750123642650624
  res = res + x121*904625697166532776746648320380374280103671755200316906558262375061821325312
  res = res + x120*452312848583266388373324160190187140051835877600158453279131187530910662656
  res = res + x119*226156424291633194186662080095093570025917938800079226639565593765455331328
  res = res + x118*113078212145816597093331040047546785012958969400039613319782796882727665664
  res = res + x117*56539106072908298546665520023773392506479484700019806659891398441363832832
  res = res + x116*28269553036454149273332760011886696253239742350009903329945699220681916416
  res = res + x115*14134776518227074636666380005943348126619871175004951664972849610340958208
  res = res + x114*7067388259113537318333190002971674063309935587502475832486424805170479104
  res = res + x113*3533694129556768659166595001485837031654967793751237916243212402585239552
  res = res + x112*1766847064778384329583297500742918515827483896875618958121606201292619776
  res = res + x111*883423532389192164791648750371459257913741948437809479060803100646309888
  res = res + x110*441711766194596082395824375185729628956870974218904739530401550323154944
  res = res + x109*220855883097298041197912187592864814478435487109452369765200775161577472
  res = res + x108*110427941548649020598956093796432407239217743554726184882600387580788736
  res = res + x107*55213970774324510299478046898216203619608871777363092441300193790394368
  res = res + x106*27606985387162255149739023449108101809804435888681546220650096895197184
  res = res + x105*13803492693581127574869511724554050904902217944340773110325048447598592
  res = res + x104*6901746346790563787434755862277025452451108972170386555162524223799296
  res = res + x103*3450873173395281893717377931138512726225554486085193277581262111899648
  res = res + x102*1725436586697640946858688965569256363112777243042596638790631055949824
  res = res + x101*862718293348820473429344482784628181556388621521298319395315527974912
  res = res + x100*431359146674410236714672241392314090778194310760649159697657763987456
  res = res + x99*215679573337205118357336120696157045389097155380324579848828881993728
  res = res + x98*107839786668602559178668060348078522694548577690162289924414440996864
  res = res + x97*53919893334301279589334030174039261347274288845081144962207220498432
  res = res + x96*26959946667150639794667015087019630673637144422540572481103610249216
  res = res + x95*13479973333575319897333507543509815336818572211270286240551805124608
  res = res + x94*6739986666787659948666753771754907668409286105635143120275902562304
  res = res + x93*3369993333393829974333376885877453834204643052817571560137951281152
  res = res + x92*1684996666696914987166688442938726917102321526408785780068975640576
  res = res + x91*842498333348457493583344221469363458551160763204392890034487820288
  res = res + x90*421249166674228746791672110734681729275580381602196445017243910144
  res = res + x89*210624583337114373395836055367340864637790190801098222508621955072
  res = res + x88*105312291668557186697918027683670432318895095400549111254310977536
  res = res + x87*52656145834278593348959013841835216159447547700274555627155488768
  res = res + x86*26328072917139296674479506920917608079723773850137277813577744384
  res = res + x85*13164036458569648337239753460458804039861886925068638906788872192
  res = res + x84*6582018229284824168619876730229402019930943462534319453394436096
  res = res + x83*3291009114642412084309938365114701009965471731267159726697218048
  res = res + x82*1645504557321206042154969182557350504982735865633579863348609024
  res = res + x81*822752278660603021077484591278675252491367932816789931674304512
  res = res + x80*411376139330301510538742295639337626245683966408394965837152256
  res = res + x79*205688069665150755269371147819668813122841983204197482918576128
  res = res + x78*102844034832575377634685573909834406561420991602098741459288064
  res = res + x77*51422017416287688817342786954917203280710495801049370729644032
  res = res + x76*25711008708143844408671393477458601640355247900524685364822016
  res = res + x75*12855504354071922204335696738729300820177623950262342682411008
  res = res + x74*6427752177035961102167848369364650410088811975131171341205504
  res = res + x73*3213876088517980551083924184682325205044405987565585670602752
  res = res + x72*1606938044258990275541962092341162602522202993782792835301376
  res = res + x71*803469022129495137770981046170581301261101496891396417650688
  res = res + x70*401734511064747568885490523085290650630550748445698208825344
  res = res + x69*200867255532373784442745261542645325315275374222849104412672
  res = res + x68*100433627766186892221372630771322662657637687111424552206336
  res = res + x67*50216813883093446110686315385661331328818843555712276103168
  res = res + x66*25108406941546723055343157692830665664409421777856138051584
  res = res + x65*12554203470773361527671578846415332832204710888928069025792
  res = res + x64*6277101735386680763835789423207666416102355444464034512896
  res = res + x63*3138550867693340381917894711603833208051177722232017256448
  res = res + x62*1569275433846670190958947355801916604025588861116008628224
  res = res + x61*784637716923335095479473677900958302012794430558004314112
  res = res + x60*392318858461667547739736838950479151006397215279002157056
  res = res + x59*196159429230833773869868419475239575503198607639501078528
  res = res + x58*98079714615416886934934209737619787751599303819750539264
  res = res + x57*49039857307708443467467104868809893875799651909875269632
  res = res + x56*24519928653854221733733552434404946937899825954937634816
  res = res + x55*12259964326927110866866776217202473468949912977468817408
  res = res + x54*6129982163463555433433388108601236734474956488734408704
  res = res + x53*3064991081731777716716694054300618367237478244367204352
  res = res + x52*1532495540865888858358347027150309183618739122183602176
  res = res + x51*766247770432944429179173513575154591809369561091801088
  res = res + x50*383123885216472214589586756787577295904684780545900544
  res = res + x49*191561942608236107294793378393788647952342390272950272
  res = res + x48*95780971304118053647396689196894323976171195136475136
  res = res + x47*47890485652059026823698344598447161988085597568237568
  res = res + x46*23945242826029513411849172299223580994042798784118784
  res = res + x45*11972621413014756705924586149611790497021399392059392
  res = res + x44*5986310706507378352962293074805895248510699696029696
  res = res + x43*2993155353253689176481146537402947624255349848014848
  res = res + x42*1496577676626844588240573268701473812127674924007424
  res = res + x41*748288838313422294120286634350736906063837462003712
  res = res + x40*374144419156711147060143317175368453031918731001856
  res = res + x39*187072209578355573530071658587684226515959365500928
  res = res + x38*93536104789177786765035829293842113257979682750464
  res = res + x37*46768052394588893382517914646921056628989841375232
  res = res + x36*23384026197294446691258957323460528314494920687616
  res = res + x35*11692013098647223345629478661730264157247460343808
  res = res + x34*5846006549323611672814739330865132078623730171904
  res = res + x33*2923003274661805836407369665432566039311865085952
  res = res + x32*1461501637330902918203684832716283019655932542976
  res = res + x31*730750818665451459101842416358141509827966271488
  res = res + x30*365375409332725729550921208179070754913983135744
  res = res + x29*182687704666362864775460604089535377456991567872
  res = res + x28*91343852333181432387730302044767688728495783936
  res = res + x27*45671926166590716193865151022383844364247891968
  res = res + x26*22835963083295358096932575511191922182123945984
  res = res + x25*11417981541647679048466287755595961091061972992
  res = res + x24*5708990770823839524233143877797980545530986496
  res = res + x23*2854495385411919762116571938898990272765493248
  res = res + x22*1427247692705959881058285969449495136382746624
  res = res + x21*713623846352979940529142984724747568191373312
  res = res + x20*356811923176489970264571492362373784095686656
  res = res + x19*178405961588244985132285746181186892047843328
  res = res + x18*89202980794122492566142873090593446023921664
  res = res + x17*44601490397061246283071436545296723011960832
  res = res + x16*22300745198530623141535718272648361505980416
  res = res + x15*11150372599265311570767859136324180752990208
  res = res + x14*5575186299632655785383929568162090376495104
  res = res + x13*2787593149816327892691964784081045188247552
  res = res + x12*1393796574908163946345982392040522594123776
  res = res + x11*696898287454081973172991196020261297061888
  res = res + x10*348449143727040986586495598010130648530944
  res = res + x9*174224571863520493293247799005065324265472
  res = res + x8*87112285931760246646623899502532662132736
  res = res + x7*43556142965880123323311949751266331066368
  res = res + x6*21778071482940061661655974875633165533184
  res = res + x5*10889035741470030830827987437816582766592
  res = res + x4*5444517870735015415413993718908291383296
  res = res + x3*2722258935367507707706996859454145691648
  res = res + x2*1361129467683753853853498429727072845824
  res = res + x1*680564733841876926926749214863536422912
  res = res + x0*340282366920938463463374607431768211456
  return res


def LongsightL161p5(field x) -> (field):
  field t=x*x
  x=t*t*x+8286731673356912523280191425428172264764883155933276256395726910075035231351
  t=x*x
  x=t*t*x+12625407652397967123506843053395158231452025966483390307504908470823111706736
  t=x*x
  x=t*t*x+19768810353991732019859794947600119761777791507900220068369100479406955276714
  t=x*x
  x=t*t*x+12882555502351924575262062162354377025850692117934805412807407299617866525490
  t=x*x
  x=t*t*x+14157082059420866836205206057504996167137691016851205419239406425320976347641
  t=x*x
  x=t*t*x+5661299046757654356894313080775800754010872582485973202326149537478356754192
  t=x*x
  x=t*t*x+8301073286405844631971072623642220971230052681228022363028579272329352745663
  t=x*x
  x=t*t*x+9038179022842692311897360613944253257293127727083063638468599277157195347325
  t=x*x
  x=t*t*x+12929358633548717229528758576335034665984614802920590097712518672597716403522
  t=x*x
  x=t*t*x+7139923612612919470733568510170242500170504775623573624424664052012869285503
  t=x*x
  x=t*t*x+11859074930354038961567070216661768308339427996805825601710739714753309683625
  t=x*x
  x=t*t*x+4042668197811495833860968350452844530516182530634575149149301522386303015261
  t=x*x
  x=t*t*x+4600865117674911365571761617833158384274738403629510263430108723476183930653
  t=x*x
  x=t*t*x+16532061800466596298480308523223508084324601276793964358951951470495713110492
  t=x*x
  x=t*t*x+15904463825633012143389172393175949358166372887546403349706956869143725063231
  t=x*x
  x=t*t*x+21693437901657403778531077406673190330013902962325211896274654010570931296931
  t=x*x
  x=t*t*x+12619220857763700756171078583271773336096125774833330860710235894316894789422
  t=x*x
  x=t*t*x+5725686506205373444768325727932744042519226375804576533773906954645633627388
  t=x*x
  x=t*t*x+2313574278011811075829410261172502009195418506785437951247074544634515702073
  t=x*x
  x=t*t*x+6968424351622938487219433638743094195159684790705781062313457239395048907240
  t=x*x
  x=t*t*x+6468220253148083072969620742529315633371106403734918923235075621736574973919
  t=x*x
  x=t*t*x+20707852376547574169534693730550119278611524706809246652756541910150607901212
  t=x*x
  x=t*t*x+542012516013508495692773375354921335659483037744589624189713990979449757254
  t=x*x
  x=t*t*x+1941774280175508180265361507558968655833809189046740909917731138101043001537
  t=x*x
  x=t*t*x+18527328974813083276458758340020729008975276469146532745229215454613606375053
  t=x*x
  x=t*t*x+14573591427565186727786358789863883427841964170639215552653570685991988865871
  t=x*x
  x=t*t*x+10057872913512138037983878211086585288917806301478643384719716492897311952653
  t=x*x
  x=t*t*x+19889880895653675225369995132532776090096571581899514471302374119112887625109
  t=x*x
  x=t*t*x+11969171716296573952238280902723045795544667266712909286594981443360113832839
  t=x*x
  x=t*t*x+5497443748352715699917569241848815077235691265024781183231130175722887613558
  t=x*x
  x=t*t*x+21217422544047741467240745491589788108941499297758084734929568043289453114759
  t=x*x
  x=t*t*x+17289504232904834076136100770799663636325324599737452397244122121646672165993
  t=x*x
  x=t*t*x+5456137079927584519549140930247318064173392610488841337123928761692120144904
  t=x*x
  x=t*t*x+17128928233629092189436955585544415294645542343021547891897575185071524820910
  t=x*x
  x=t*t*x+10981313285202921622968565985083735906371568034564829329272967088906008789403
  t=x*x
  x=t*t*x+7913894589381110055910863889452555723219434320853911097259440034144601393891
  t=x*x
  x=t*t*x+7091010281468211653614378056793593785959222701805518145019201745929656115076
  t=x*x
  x=t*t*x+18545612911127241813996481983784187997987623341276080623049759857571284225041
  t=x*x
  x=t*t*x+16559497519677056762694757958396165447689191095030413804786647207457245400302
  t=x*x
  x=t*t*x+2097490733243137499280632020830827432386735097934647132587076094373160989288
  t=x*x
  x=t*t*x+4019342831078354133117509306739798619829350213797642191487554910186760066711
  t=x*x
  x=t*t*x+8856051160255492833679703526771208697209558264819551185180419055307372689732
  t=x*x
  x=t*t*x+9952054552375755048154941267184583803316302299868050528360604821233307570049
  t=x*x
  x=t*t*x+16709458059504746234583652133381137908197145008593251318304920809158246616850
  t=x*x
  x=t*t*x+11895439068671571442601266199129694177439240501502357426740683335495738861198
  t=x*x
  x=t*t*x+17709042834997492202170454278194600519056913057083839723732451498917663044527
  t=x*x
  x=t*t*x+11251793053149206560847588768186235718793625065256409786675979880735227657672
  t=x*x
  x=t*t*x+2016577486283507598987440101390142127518057615407339615299597241343952643852
  t=x*x
  x=t*t*x+9917578719279831204145283035071981963603265340800953468483432518257086741847
  t=x*x
  x=t*t*x+11779579467454608386614573509184571412323154479816702718945875397457513099690
  t=x*x
  x=t*t*x+2064282474315896812812612139247625017963922393219524423573007798561717261019
  t=x*x
  x=t*t*x+8388314493585716315369879441372650319665008966651878005755978615745609823603
  t=x*x
  x=t*t*x+7299978548537313367787777242631409366001255628850647249319879676205763195812
  t=x*x
  x=t*t*x+19661630871765270938790176672874144363669691582020687639357833232756166663945
  t=x*x
  x=t*t*x+21598221292212782906142335853757913105215230021368543115952077765553346479190
  t=x*x
  x=t*t*x+19370702945946348840227431193449619207526098539041104974202600210290542830914
  t=x*x
  x=t*t*x+20565452240561554026101922464211972482448734048017565342284998697157542661442
  t=x*x
  x=t*t*x+21572455661526077774131927415064559832098955423545785824050373114850272229140
  t=x*x
  x=t*t*x+20324236213409943482088412946789767539200293491090083872731104377913408053622
  t=x*x
  x=t*t*x+6728855040615012825254806299110617610363087921545285584628240688134989023222
  t=x*x
  x=t*t*x+4958304631103991656710882421340614114976514622861243771520389433005697246158
  t=x*x
  x=t*t*x+9302220256021544545535206472839611205482596772641265128972429454889271539717
  t=x*x
  x=t*t*x+15366504352094692017493091122242591091959115124913453585574248506043757697485
  t=x*x
  x=t*t*x+21249180722777840395594659723945811856677487758566367986688848843328736650981
  t=x*x
  x=t*t*x+18829502016895011869108079683384030843463845873199012510803384106053921420918
  t=x*x
  x=t*t*x+5530329513321057666278953146770286057265614145806468034990019333869474498158
  t=x*x
  x=t*t*x+14450052230583469292061033047802393320634860655134885615868288683224055001063
  t=x*x
  x=t*t*x+11304068522817128175905704724577183357217618741701553226638253531609398181563
  t=x*x
  x=t*t*x+4013446328636073355915501330197858254451789470444849651836560265344198631514
  t=x*x
  x=t*t*x+17672961303842491925947643281904698509210919715342893931689441410749416684212
  t=x*x
  x=t*t*x+10989149132301452686329423802661029776151478597752901280913256264733384267476
  t=x*x
  x=t*t*x+18289748873010321242637454805872633328592190311424623558350963336043572202882
  t=x*x
  x=t*t*x+13756749850461307701312205981002334212971353778122171513911311407056569829431
  t=x*x
  x=t*t*x+3234366156263419026160066886419284318255249872366513417869583396146782485507
  t=x*x
  x=t*t*x+12365329020412267814787126360138909850512525235328526482834611342667137932111
  t=x*x
  x=t*t*x+8640717590037580746014594906153365315258666027105386803998713138668126029787
  t=x*x
  x=t*t*x+13968098957658172030591199931905182866822976805569970086642922188623018540877
  t=x*x
  x=t*t*x+449802991871849661949917440060562344023232784226353533644792529341056798631
  t=x*x
  x=t*t*x+4302006518824621719828636231399255611213070071262015451098750801008434850046
  t=x*x
  x=t*t*x+4931567912855578304955830231266806712190335010314458539083983782895755155355
  t=x*x
  x=t*t*x+14518018355147793190941913210685035423702109654774401085935497152012842696984
  t=x*x
  x=t*t*x+14095424909312556451870353729762706905060165521582632545092877193729245065632
  t=x*x
  x=t*t*x+21360022358187664063706169338644165432179890586684713453429006976048576102715
  t=x*x
  x=t*t*x+8518115046000329875189006591373517252074219337334251143762339983758600450387
  t=x*x
  x=t*t*x+158160828078767866688683318143449292280461902149769898614264674134176465069
  t=x*x
  x=t*t*x+20722684986431869662886929390937744072109748042752467411712077009387170809864
  t=x*x
  x=t*t*x+17625710341585149687629518748953342980429904032958906296634575452278788668881
  t=x*x
  x=t*t*x+17508126361840446458749583567233316467974376435599192337584139701919444528747
  t=x*x
  x=t*t*x+8560707195241612758269713297625553702051732552702226338867342435088123480294
  t=x*x
  x=t*t*x+11442111553206718451807269621320928695237683408524868662598896793932593660120
  t=x*x
  x=t*t*x+3436190177398503048195745336098080042723881466729380218298911664635318648978
  t=x*x
  x=t*t*x+17861997540320708149691557371008340468824592509475090374890843203618925606823
  t=x*x
  x=t*t*x+524225174111864386879864750267048044018674435439375432704787261410880741133
  t=x*x
  x=t*t*x+9877487741562768829557134477943178021473170386371575748231450537025238747414
  t=x*x
  x=t*t*x+6611508186623032644028993372745191905442390291100954076863265246940834693713
  t=x*x
  x=t*t*x+11495773413195505905905002228570787843121272522317608142271883576334523670496
  t=x*x
  x=t*t*x+20602422555565828382817270137931371927221329698086170203117090952172253422943
  t=x*x
  x=t*t*x+1049394770400251376016159168058575713582857091704718845939930070629933327495
  t=x*x
  x=t*t*x+21193204352972322469523032358846971981276185149976587639977876956734175018014
  t=x*x
  x=t*t*x+3338743417929121928623088635468713366204512182205867151486311401900393351993
  t=x*x
  x=t*t*x+7789969863806899021410024685099483145920357543202666061579322815808476148059
  t=x*x
  x=t*t*x+6414154346321279393887826963706556535716107410392538848292635249157797954764
  t=x*x
  x=t*t*x+11767387162798547156219233460720359425784347454529479155283746732896016964231
  t=x*x
  x=t*t*x+11518202225759048624870404309687650610991557054813664759812276998980059799293
  t=x*x
  x=t*t*x+16827462746617442813280281862731521835082853855664201253854507133501559671193
  t=x*x
  x=t*t*x+21362199464239141197298569984060386761734065332939549494946666248205835507953
  t=x*x
  x=t*t*x+16339566910702015447882336824311118192002519856836114899186906846357871330152
  t=x*x
  x=t*t*x+14468421632232746748330067626809354139314254625055588407183874788035557753082
  t=x*x
  x=t*t*x+7400899788863425607536848172938036975723443090732700766516814986365021421224
  t=x*x
  x=t*t*x+11614152628922317280619324414042675829456318010433893757133455520948202431942
  t=x*x
  x=t*t*x+2858714975369437864819884505358916796268252864605806079529419620890541360592
  t=x*x
  x=t*t*x+16500619384222178068311933604462519713074424376995122459762700757729511234378
  t=x*x
  x=t*t*x+19735078265316574156602281890893017225973699695165856741619227823631998969311
  t=x*x
  x=t*t*x+13071985831031444516086195289258406798202596218295849028761437393740890087023
  t=x*x
  x=t*t*x+17423632613633171197512330951799018325821404714569460500637116646422473269663
  t=x*x
  x=t*t*x+19561358298998258505858739780303256855393532041936220024432981434599522296344
  t=x*x
  x=t*t*x+7682494313363113418523119780842436801333364192799972944951504980493589118223
  t=x*x
  x=t*t*x+1162067969544003759163325860621871128909142527440086522370331930193385114801
  t=x*x
  x=t*t*x+15079683436975148007239326167645563522333833216203279315886766656873266790286
  t=x*x
  x=t*t*x+19822190778898203219579939161083086721508283676090948654221347454355508531775
  t=x*x
  x=t*t*x+63415857729537008241964828179498124562804635645442672796034859883051844140
  t=x*x
  x=t*t*x+18408588010873377213261250194534963449058841843503130834013661793097156461402
  t=x*x
  x=t*t*x+16749579293806563738747964011732431061814390369983120824593567656697969771803
  t=x*x
  x=t*t*x+4722721929867331132763731853342614903137046044900877854662659913070423195979
  t=x*x
  x=t*t*x+14323684303743728460352648733600565577477771579378504734843753011262395369468
  t=x*x
  x=t*t*x+12883989893041823947540513671600796257536896243443899776953900735764408182084
  t=x*x
  x=t*t*x+8730715019017484593523163359556554772490247864221778510328655807581500943496
  t=x*x
  x=t*t*x+8430039454683605264687810172778593468434848629869393038147580627291219562608
  t=x*x
  x=t*t*x+16958407849102644117412796726714299835042504042417406167238912945324945361985
  t=x*x
  x=t*t*x+12580564292200185398985906962977581838419836637086310747900236273531115775464
  t=x*x
  x=t*t*x+5048444508624633483630335245093399711073148181796315834786733961522682297411
  t=x*x
  x=t*t*x+8236336921338138384421933203662091709981759101163962775336963572876300026208
  t=x*x
  x=t*t*x+12930505244464359033960764784302854207721776521682142158700432994096879864305
  t=x*x
  x=t*t*x+5259143090926448716623039683872136148131228458510194061558710652766348932401
  t=x*x
  x=t*t*x+1406569093527758698041105783766754987478748619496355004317894852111562229283
  t=x*x
  x=t*t*x+20687258564888861544596952506580906184971410013223823969270642715850566131715
  t=x*x
  x=t*t*x+12546438219876894005597843524875395594781458144329659224217139223693426788264
  t=x*x
  x=t*t*x+3347719428229064803519549420618160472689750315422919036143847294758627999235
  t=x*x
  x=t*t*x+18646867294650237375287633662362377660952770579302151703768018167250951556567
  t=x*x
  x=t*t*x+5339280501345399831241685838275914747180258738689697280397086929615134293437
  t=x*x
  x=t*t*x+14143478753343425351827113791309813590977683571862766123672112963338426983704
  t=x*x
  x=t*t*x+4465306272250944648281563864119126334913751841344254949642459662572948104927
  t=x*x
  x=t*t*x+9283956966742959492906070051338600184179532573995957668462196412292545590658
  t=x*x
  x=t*t*x+7532673187502276893565758783020010663743682210893812265781408049014087696998
  t=x*x
  x=t*t*x+20404854744338867410996413629994456128130416259949040955724653813748236199766
  t=x*x
  x=t*t*x+19431160498329315734305132875547102921407599694273307169666749561722505385745
  t=x*x
  x=t*t*x+13433168888177352415232821467794712894689938424787896269693595072563794122131
  t=x*x
  x=t*t*x+7278843596654617279680913124068238289468855084438876658633900840173682381600
  t=x*x
  x=t*t*x+425870966971601190943412224092597598987208111622712428461283558088714092782
  t=x*x
  x=t*t*x+17258213473098746246775193310971530115447268113368172570043220573318241032296
  t=x*x
  x=t*t*x+15025290158079398133367466185733739567582092431736328559322135455988580531316
  t=x*x
  x=t*t*x+17301484297554767728747239963909674147903824963456382517419670697121337176944
  t=x*x
  x=t*t*x+18009227606887550667554592914338427942864328368423275893517610652272813060241
  t=x*x
  x=t*t*x+16254996636292385215521791519347461183485322505353337730680564521305306827999
  t=x*x
  x=t*t*x+9742975288912895735881208724884719444737365886645027132335302219685792320166
  t=x*x
  x=t*t*x+15703766002696769124689382647000091854073781548639909211455331178573956790817
  t=x*x
  x=t*t*x+15040575849573723294582697665720883826576709636110063830239453808028572207660
  t=x*x
  x=t*t*x+7910701025125097875669825324891165587206635822091997951143479337503249580246
  t=x*x
  x=t*t*x+15744478991889149701004379661885787196683958272676607076695453170688059341851
  t=x*x
  x=t*t*x+11222527129243032663455754211819884767746828636648904862783836408967138302994
  t=x*x
  x=t*t*x+14863514518721053864412026859144871123834424860287678807168269503919871377341
  return x


def alghash(field x, field y) -> (field):
  return truncate(LongsightL161p5(x), LongsightL161p5(y))


def compress4(field x1, field x2, field x3, field x4) -> (field):
  return alghash(alghash(alghash(x1, x2), x3), x4)


def s32(field offset, field[512] input) -> (field[32]):
	field[32] result = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
	for field i in 0..32 do
		result[i] = input[offset + i]
	endfor
return result


def smp(field sliceBegin, field sliceEnd, field[32] proofHash, field[32] proofLength, field[32] proofBit) -> (field):
  field curHash = 0
  field curLeft = sliceBegin
  field curLength = sliceEnd - sliceBegin
  for field i in 0..32 do
    curHash = compress4(proofLength[i], curLength, proofHash[i], curHash)*proofBit[i]+compress4(curLength, proofLength[i], curHash, proofHash[i])*(1-proofBit[i])
    curLeft = curLeft - proofLength[i]*proofBit[i]
    curLength = curLength + proofLength[i]
  endfor
  curLeft == 0
  //for 32bit plasma state
  curLength == 4294967295
  return curHash


def main(field proofSliceBegin, field proofSliceEnd, private field[16] rootHash, private field[16] sliceBegin, private field[16] sliceEnd, private field[512] proofHash, private field[512] proofLength, private field[512] proofBit) -> (field):
  for field i in 0..512 do
    proofBit[i] == proofBit[i] * proofBit[i]
  endfor

  field curHash = 0
  for field i in 0..16 do
    curHash = alghash(curHash, rootHash[i])
    rootHash[i]==smp(sliceBegin[i], sliceEnd[i], s32(i*32, proofHash), s32(i*32, proofLength), s32(i*32, proofBit))
  endfor
  return curHash
